(function(f){function l(a){if(!(this instanceof l))return new l(a);this.message=a}function A(a){return a.search(B)!==-1}function C(a){return a.search(D)!==-1}function E(a){return a.search(F)!==-1}function q(a){return a.replace(/^[\s]+/,"").replace(/[\s]+$/,"")}function r(a){return a instanceof f?G(a):a!==null&&!v(a)&&typeof a==="object"?typeof a.toHTML==="function"?r(a.toHTML()):a.toString():a}function s(a,b){var d=w(a,"."),c=b[d[0]],e;for(e=1;e<d.length;e++)if(c!==undefined)c=c[d[e]];else return"";
return r(c===undefined?"":c)}function G(a){return f(document.createElement("div")).append(a).html()}function t(a){if(a===undefined)return a;var b=function(){};b.prototype=a;return new b}function H(){var a=[];f.each(m,function(b,d){a.push([b,d])});return a}function I(a){return typeof m[a]==="string"?m[a]:a}function v(a){return Object.prototype.toString.apply(a)==="[object Array]"}function J(a,b){return v(a)?f.each(a,b):b(0,a)}function K(a){return function(b){var d=[];for(i=0;i<b.length;i++)b[i]===
""||d.push(b[i]);return d}(w(a,new RegExp("("+F.source+"|"+B.source+"|"+D.source+")")))}function o(a){return a.slice(1)}function u(a,b){return b.concat([a])}function L(a){var b=t(T);b.name=q(a.replace(M,"").replace(N,""));return b}function O(a){var b=t(U);b.text=a;return b}function x(a){return function(b,d){var c=d[0];return d.length===0?[b,[],true]:C(c)?[b,o(d)]:E(c)?arguments.callee(u(L(c),b),o(d)):A(c)?P(b,d,arguments.callee):arguments.callee(u(O(c),b),o(d))}([],a)}function Q(a){return function(b,
d){for(i=0;i<d.length;i++)(function(c){return c===""?null:b.push(c)})(q(d[i]));return b}([],w(a.replace(y,"").replace(z,""),/[\s]+?/))}function P(a,b,d){var c=Q(b[0]),e=c[0];c=o(c);e=t(R[e]);if(e===undefined)throw new l("Unknown Block Tag.");e.args=c;b=o(b);if(e.expectsEndTag===true){b=x(b);if(b[2]!==undefined)throw new l("A block tag was expecting an ending tag but it was not found.");e.subNodes=b[0];b=b[1]}a=u(e,a);return d(a,b)}function S(a,b){var d=I(a),c=[];J(b,function(e,k){var h=x(K(d),k),
p=h[0];if(h[1].length!==0)throw new l("An unexpected end tag was found.");f.each(p,function(n,V){c.push(V.render(k))})});return function(e){return e.charAt(0)==="<"?f(e):e}(q(c.join("")))}var m={},M=/\{\{[\s]*?/g,N=/[\s]*?\}\}/g,y=/\{%[\s]*?/g,z=/[\s]*?%\}/g,F=new RegExp(M.source+"[\\w\\-\\.]+?"+N.source,"g"),B=new RegExp(y.source+"[\\w]+?(?:[ ]+?[\\w\\-\\.]*?)*?"+z.source,"g"),D=new RegExp(y.source+"end[\\w]*?"+z.source,"g"),R={"for":{expectsEndTag:true,render:function(a){var b=this.args,d=this.subNodes,
c=d.length,e=[],k,h,p,n;if(b.length===3&&b[1]==="in"){k=b[0];b=b[2];h=s(b,a);p=h.length;for(b=0;b<p;b++){n={};n[k]=h[b];n._index=b;n=f.extend({},a,n);for(j=0;j<c;j++)e.push(d[j].render(n))}return e.join("")}else throw new l("Bad for tag syntax. Use {% for <item> in <array> %}");}},"if":{expectsEndTag:true,render:function(a){var b=[],d=this.subNodes;s(this.args[0],a)&&f.each(d,function(c,e){b.push(e.render(a))});return b.join("")}}},U={render:function(){return this.text||""}},T={render:function(a){var b=
a[this.name]===undefined?"":a[this.name];if(b===""&&this.name.search(/\./)!==-1)return s(this.name,a);return r(b)}};l.prototype=new SyntaxError;l.prototype.name="TemplateSyntaxError";var w=function(){return"abc".split(/(b)/).length===3?function(a,b){return String.prototype.split.call(a,b)}:function(a,b){if(Object.prototype.toString.call(b)==="[object RegExp]"){var d=b.ignoreCase?new RegExp(b.source,"gi"):new RegExp(b.source,"g"),c,e="",k=[],h,p=a.length;for(h=0;h<p;h++){e+=a.charAt(h);c=e.match(d);
if(c!==null&&c.length>0){k.push(e.replace(c[0],""));k.push(c[0]);e=""}}e!==""&&k.push(e);return k}else return String.prototype.split.call(a,b)}}();f.extend({tempest:function(){var a=arguments;if(a.length===0)return H();else if(a.length===2&&typeof a[0]==="string"&&typeof a[1]==="object")return S(a[0],a[1]);else if(a.length===1&&typeof a[0]==="string")return m[a[0]];else if(a.length===2&&typeof a[0]==="string"&&typeof a[1]==="string"){m[a[0]]=a[1].replace(/^\s+/g,"").replace(/\s+$/g,"").replace(/[\n\r]+/g,
"");return m[a[0]]}else throw new TypeError("jQuery.tempest can't handle the given arguments.");}});f.fn.tempest=function(){var a=Array.prototype.slice.call(arguments,0);if(a.length===2&&typeof a[0]==="string"&&typeof a[1]==="object")return f(this).html(f.tempest(a[0],a[1]));else if(a.length===3&&typeof a[0]==="string"&&typeof this[a[0]]==="function"&&typeof a[1]==="string"&&typeof a[2]==="object")return f(this)[a[0]](f.tempest(a[1],a[2]));else throw new TypeError(["jQuery(selector).tempest was passed the wrong number or type",
"of arguments. Received "+a].join(" "));};f.tempest.tags=R;f.tempest.getContextValue=s;f.tempest.TemplateSyntaxError=l;if(window.testTempestPrivates===true){f.tempest._test={};var g=function(a,b){f.tempest._test[a]=b};g("isBlockTag",A);g("isEndTag",C);g("isVarTag",E);g("cleanVal",r);g("jQueryToString",G);g("makeObj",t);g("storedTemplates",H);g("chooseTemplate",I);g("isArray",v);g("renderEach",J);g("tokenize",K);g("cdr",o);g("append",u);g("makeVarNode",L);g("makeTextNode",O);g("makeNodes",x);g("makeBits",
Q);g("makeBlockNode",P);g("renderToJQ",S);g("strip",q)}f(document).ready(function(){f(".tempest-template").each(function(){m[f(this).attr("title")]=q((f(this).val()||f(this).html()).replace(/[\n\r]+/g," "));f(this).remove()})})})(jQuery);